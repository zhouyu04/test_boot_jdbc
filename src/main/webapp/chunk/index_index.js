(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"12":function(e,t,n){"use strict";n.r(t),n.d(t,"default",function(){return y});var a=n(32),o=n.n(a),i=n(0),r=n(91),s=n(86),c=n(1),l=(n(36),n(87)),d=n(93),u=n(88),h=n(92),m=n(90),p=(n(38),function(){function defineProperties(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(e,t,n){return t&&defineProperties(e.prototype,t),n&&defineProperties(e,n),e}}());function _asyncToGenerator(e){return function(){var t=e.apply(this,arguments);return new Promise(function(e,n){return function step(a,o){try{var i=t[a](o),r=i.value}catch(e){return void n(e)}if(!i.done)return Promise.resolve(r).then(function(e){step("next",e)},function(e){step("throw",e)});e(r)}("next")})}}var f=window.location.origin+"/openapi/rest?method=jdy.member.wechatmessageservice.activateNew",b=window.location.origin+"/openapi/rest?method=jdy.member.wechatmessageservice.getUserInfo",w=window.location.origin+"/smart",v=function parseQueryString(){var e=window.decodeURIComponent(window.location.href),t=e.indexOf("?");if(t<0)return{};var n=e.indexOf("#");return n<0&&(n=e.length),function parse(e){var t={"name":"","sex":"","birthday":"","mobile":"","dbid":"","fdbid":""};return e&&"string"==typeof e?(e.split("&").forEach(function(e){var n=e.indexOf("=");if(!(n<0)){var a=decodeURIComponent(e.slice(0,n)),o=e.slice(n+1,e.length);t[a]="null"===o?"":o}}),t.dbid=t.fdbid,t):t}(e.slice(t+1,n))},y=function(e){function Index(e){var t=this;!function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,Index);var n=function _possibleConstructorReturn(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(Index.__proto__||Object.getPrototypeOf(Index)).call(this,e));return n.checkStores=function(){0!==n.state.storeList.length||Object(r.a)({"title":"未获取到门店数据","icon":"none","duration":1500,"mask":!0})},n.changeStore=function(e){if(0!==n.state.storeList.length){var t=n.state.storeList[e.detail.value];n.setState({"storeId":t.storeId,"storeName":t.storeName})}},n.onSubmit=function(){var e=n.state.password||"",t=n.state.repeatPwd||"";if(e){if(!/^\d{6}$/.test(e))return void Object(r.a)({"title":"请输入6位数字格式密码","icon":"none","duration":1500,"mask":!0});if(e!==t)return void Object(r.a)({"title":"两次输入密码不一致，请重新输入","icon":"none","duration":1500,"mask":!0})}n.activate()},n.initMemberData=_asyncToGenerator(o.a.mark(function _callee(){var e;return o.a.wrap(function _callee$(t){for(;;)switch(t.prev=t.next){case 0:(e=v()).mobile?n.setState({"mobile":e.mobile,"name":e.name,"sex":e.sex,"birthday":e.birthday,"dbid":e.dbid}):n.getMemberData();case 2:case"end":return t.stop()}},_callee,t)})),n.getMemberData=_asyncToGenerator(o.a.mark(function _callee2(){return o.a.wrap(function _callee2$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Object(s.a)({"url":b,"method":"POST","credentials":"include","data":JSON.stringify({"weixin":v()}),"fail":function fail(e){Object(r.a)({"title":"未知错误 "+e.statusText,"icon":"none","duration":1500,"mask":!0})},"success":function success(e){200==+e.data.result?n.setState({"mobile":e.data.mobile||"","name":e.data.name||"","sex":e.data.sex||"","birthday":e.data.birthday||"","dbid":e.data.dbid||""}):Object(r.a)({"title":"获取会员信息失败","icon":"none","duration":1500,"mask":!0})}});case 2:case"end":return e.stop()}},_callee2,t)})),n.initShopData=_asyncToGenerator(o.a.mark(function _callee3(){var e;return o.a.wrap(function _callee3$(t){for(;;)switch(t.prev=t.next){case 0:return e={"cmd":"retail.shop.q","dbid":n.state.dbid,"page_num":0,"page_size":500},t.next=3,Object(s.a)({"url":w,"method":"POST","header":{"content-type":"application/json"},"data":JSON.stringify(e),"complete":function complete(e){console.log(e)},"fail":function fail(e){console.log("fail"),console.log(e)},"success":function success(e){if(e.data.flds.length){var t=[];e.data.rows.map(function(e){var n={"storeId":"","storeName":""};n.storeId=e[0],n.storeName=e[2],t.push(n)}),n.setState({"storeList":t})}}});case 3:case"end":return t.stop()}},_callee3,t)})),n.activate=_asyncToGenerator(o.a.mark(function _callee4(){var e;return o.a.wrap(function _callee4$(t){for(;;)switch(t.prev=t.next){case 0:return e={"user":{"mobile":n.state.mobile,"name":n.state.name,"birthday":n.state.birthday,"sex":n.state.sex,"password":n.state.password,"storeId":n.state.storeId},"weixin":v()},n.setState({"isActivate":!0}),t.next=4,Object(s.a)({"url":f+"&dbid="+n.state.dbid,"method":"POST","credentials":"include","header":{"content-type":"application/json"},"data":JSON.stringify(e),"success":function success(e){200==+e.data.result?Object(r.a)({"title":e.data.msg||"会员激活成功，请关闭当前页面","icon":"success","duration":2500}):Object(r.a)({"title":"会员激活失败  "+e.data.msg||!1,"icon":"none"})},"fail":function fail(e){Object(r.a)({"title":"会员激活失败"+JSON.stringify(e),"icon":"none"})}});case 4:n.setState({"isActivate":!1});case 5:case"end":return t.stop()}},_callee4,t)})),n.config={"navigationBarTitleText":"首页"},n.state={"mobile":"***********","name":"***","sex":"男","birthday":"2020-02-02","storeId":"","storeName":"","password":"","repeatPwd":"","dbid":"","storeList":[],"isActivate":!1},n}return function _inherits(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{"constructor":{"value":e,"enumerable":!1,"writable":!0,"configurable":!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(Index,c["a"].Component),p(Index,[{"key":"onReset","value":function onReset(){}},{"key":"noChange","value":function noChange(){}},{"key":"handlePwdChange","value":function handlePwdChange(e){this.setState({"password":e})}},{"key":"handleRepeatPwdChange","value":function handleRepeatPwdChange(e){this.setState({"repeatPwd":e})}},{"key":"componentWillMount","value":function(){var e=_asyncToGenerator(o.a.mark(function _callee5(){return o.a.wrap(function _callee5$(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.initMemberData();case 2:return e.next=4,this.initShopData();case 4:case"end":return e.stop()}},_callee5,this)}));return function componentWillMount(){return e.apply(this,arguments)}}()},{"key":"componentDidMount","value":function componentDidMount(){}},{"key":"componentWillUnmount","value":function componentWillUnmount(){}},{"key":"componentDidShow","value":function componentDidShow(){}},{"key":"componentDidHide","value":function componentDidHide(){}},{"key":"render","value":function render(){return i.j.createElement(l.a,{"className":"member-info"},i.j.createElement(u.a,{"className":"member-form","onSubmit":this.onSubmit,"onReset":this.onReset},i.j.createElement(h.a,{"name":"mobile","title":"手机号","type":"text","value":this.state.mobile,"editable":!1,"onChange":this.noChange}),i.j.createElement(h.a,{"name":"name","title":"姓名","type":"text","value":this.state.name,"editable":!1,"onChange":this.noChange}),i.j.createElement(h.a,{"name":"sex","title":"性别","type":"text","value":this.state.sex,"editable":!1,"onChange":this.noChange}),i.j.createElement(h.a,{"name":"birthday","title":"生日","type":"text","value":this.state.birthday,"editable":!1,"onChange":this.noChange}),i.j.createElement("div",{"className":"option-info"},"选填信息"),i.j.createElement(h.a,{"maxLength":6,"placeholder":"请输入6位数字密码","name":"password","title":"密码","type":"password","value":this.state.password,"onChange":this.handlePwdChange.bind(this)}),i.j.createElement(h.a,{"maxLength":6,"placeholder":"请重复输入密码","name":"repeatPwd","title":"确认密码","type":"password","value":this.state.repeatPwd,"onChange":this.handleRepeatPwdChange.bind(this)}),i.j.createElement(l.a,{"onClick":this.checkStores},i.j.createElement(d.a,{"disabled":!this.state.storeList.length,"mode":"selector","rangeKey":"storeName","range":this.state.storeList,"onChange":this.changeStore},i.j.createElement(l.a,{"className":"picker"},i.j.createElement(h.a,{"placeholder":"点击选择门店","name":"storeName","title":"选择门店","type":"text","value":this.state.storeName,"editable":!1,"onChange":this.noChange})))),i.j.createElement(m.a,{"formType":"submit","className":"check-btn","loading":this.state.isActivate},"激活会员卡")))}}]),Index}()},"38":function(e,t,n){}}]);